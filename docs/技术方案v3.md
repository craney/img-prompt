# img-prompt é¡¹ç›®ï¼šImage to Prompt åŠŸèƒ½é¡µé¢æŠ€æœ¯æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: Image to Prompt åŠŸèƒ½é¡µé¢å¼€å‘  
**æŠ€æœ¯æ–¹æ¡ˆç‰ˆæœ¬**: v3.0  
**è®¾è®¡æ—¥æœŸ**: 2025-09-11  
**å¯¹åº”äº§å“æ–‡æ¡£**: äº§å“åŠŸèƒ½è¿­ä»£v3.md  
**é¡¹ç›®æ¶æ„**: åŸºäºç°æœ‰ Next.js 14 + Monorepo æ¶æ„  

---

## éœ€æ±‚èƒŒæ™¯

### ä¸šåŠ¡éœ€æ±‚
å¤åˆ» https://imageprompt.org/image-to-prompt é¡µé¢åŠŸèƒ½ï¼Œå®ç°å®Œæ•´çš„"å›¾ç‰‡è½¬æç¤ºè¯"å·¥å…·ã€‚ç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡ï¼Œé€‰æ‹©AIæ¨¡å‹ï¼Œç”Ÿæˆå¯¹åº”çš„å›¾åƒæç¤ºè¯ã€‚

### æŠ€æœ¯çº¦æŸ
- åŸºäºç°æœ‰é¡¹ç›®æ¶æ„ï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´
- å¤ç”¨ç°æœ‰UIç»„ä»¶åº“å’Œæ ·å¼ç³»ç»Ÿ
- æ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€å›¾ç‰‡é¢„å¤„ç†ã€AIæœåŠ¡è°ƒç”¨
- ç¡®ä¿å“åº”å¼è®¾è®¡å’Œå›½é™…åŒ–æ”¯æŒ

---

## æŠ€æœ¯æ¶æ„è®¾è®¡

### è·¯ç”±ç»“æ„
```
apps/nextjs/src/app/[lang]/(tools)/
â”œâ”€â”€ image-to-prompt/
â”‚   â”œâ”€â”€ page.tsx                      # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ loading.tsx                   # åŠ è½½çŠ¶æ€
â”‚   â”œâ”€â”€ error.tsx                     # é”™è¯¯å¤„ç†
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ image-upload-section.tsx  # ä¸Šä¼ åŒºåŸŸ
â”‚       â”œâ”€â”€ image-preview-section.tsx # é¢„è§ˆåŒºåŸŸ
â”‚       â”œâ”€â”€ feature-tabs.tsx          # åŠŸèƒ½åˆ‡æ¢
â”‚       â”œâ”€â”€ model-selection.tsx       # æ¨¡å‹é€‰æ‹©
â”‚       â”œâ”€â”€ language-selector.tsx     # è¯­è¨€é€‰æ‹©
â”‚       â””â”€â”€ prompt-generator.tsx      # ç”Ÿæˆå™¨
```

### æ ¸å¿ƒç»„ä»¶æ¶æ„

#### 1. ä¸»é¡µé¢ç»„ä»¶ (page.tsx)
```typescript
export default async function ImageToPromptPage({
  params: { lang }
}: {
  params: { lang: Locale }
}) {
  const dict = await getDictionary(lang);
  
  return (
    <div className="container mx-auto px-4 py-8 max-w-6xl">
      <ImageToPromptHeader dict={dict.imageToPrompt.header} />
      <FeatureTabs active="image-to-prompt" dict={dict.imageToPrompt.tabs} />
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
        <ImageUploadSection dict={dict.imageToPrompt.upload} />
        <ImagePreviewSection dict={dict.imageToPrompt.preview} />
      </div>
      
      <ModelSelection dict={dict.imageToPrompt.models} />
      <PromptGenerator dict={dict.imageToPrompt.generator} />
    </div>
  );
}
```

#### 2. æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
```typescript
export function ImageUploadSection({ dict }: Props) {
  const [dragActive, setDragActive] = useState(false);
  const [file, setFile] = useState<File | null>(null);
  const [imageUrl, setImageUrl] = useState("");
  
  const handleDrop = useCallback((e: DragEvent) => {
    e.preventDefault();
    setDragActive(false);
    
    const files = Array.from(e.dataTransfer.files);
    const imageFile = files.find(file => file.type.startsWith('image/'));
    
    if (imageFile && validateFile(imageFile)) {
      setFile(imageFile);
    }
  }, []);
  
  return (
    <div className="space-y-6">
      {/* æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ */}
      <div 
        className={cn(
          "border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200",
          dragActive ? "border-purple-500 bg-purple-50" : "border-purple-300 hover:border-purple-400"
        )}
        onDrop={handleDrop}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
      >
        <Icons.Upload className="w-12 h-12 text-purple-500 mx-auto mb-4" />
        <h3 className="text-lg font-medium mb-2">{dict.dragText}</h3>
        <p className="text-sm text-muted-foreground mb-6">{dict.formatText}</p>
        
        <Button 
          variant="outline" 
          onClick={() => fileInputRef.current?.click()}
        >
          {dict.uploadButton}
        </Button>
      </div>
      
      {/* URL è¾“å…¥ */}
      <div className="flex gap-2">
        <Input
          placeholder={dict.urlPlaceholder}
          value={imageUrl}
          onChange={(e) => setImageUrl(e.target.value)}
          className="flex-1"
        />
        <Button onClick={handleUrlUpload} disabled={!imageUrl}>
          Upload
        </Button>
      </div>
    </div>
  );
}
```

#### 3. æ¨¡å‹é€‰æ‹©ç»„ä»¶
```typescript
const models = [
  {
    id: 'general',
    title: 'General Image Prompt',
    description: 'Natural language description of the image',
    selected: true
  },
  // ... å…¶ä»–æ¨¡å‹
];

export function ModelSelection({ dict }: Props) {
  const [selectedModel, setSelectedModel] = useState('general');
  
  return (
    <div className="mt-12">
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {models.map((model) => (
          <Card 
            key={model.id}
            className={cn(
              "cursor-pointer transition-all duration-200 hover:shadow-md",
              selectedModel === model.id 
                ? "border-purple-500 bg-purple-50 dark:bg-purple-900/10" 
                : "border-gray-200 hover:border-purple-300"
            )}
            onClick={() => setSelectedModel(model.id)}
          >
            <CardContent className="p-4">
              <div className="flex items-start gap-3">
                {selectedModel === model.id && (
                  <Icons.Check className="w-5 h-5 text-purple-600 mt-0.5" />
                )}
                <div>
                  <h3 className="font-medium text-sm mb-2">{model.title}</h3>
                  <p className="text-xs text-muted-foreground">
                    {model.description}
                  </p>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  );
}
```

### çŠ¶æ€ç®¡ç†è®¾è®¡

ä½¿ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼š

```typescript
interface ImageToPromptStore {
  // ä¸Šä¼ çŠ¶æ€
  uploadedFile: File | null;
  uploadedImageUrl: string;
  isUploading: boolean;
  
  // é€‰æ‹©çŠ¶æ€
  selectedModel: string;
  promptLanguage: string;
  
  // ç”ŸæˆçŠ¶æ€
  generatedPrompt: string;
  isGenerating: boolean;
  
  // Actions
  setUploadedFile: (file: File | null) => void;
  setSelectedModel: (model: string) => void;
  setPromptLanguage: (language: string) => void;
  generatePrompt: () => Promise<void>;
}

export const useImageToPromptStore = create<ImageToPromptStore>((set, get) => ({
  uploadedFile: null,
  uploadedImageUrl: '',
  isUploading: false,
  selectedModel: 'general',
  promptLanguage: 'english',
  generatedPrompt: '',
  isGenerating: false,
  
  setUploadedFile: (file) => set({ uploadedFile: file }),
  setSelectedModel: (model) => set({ selectedModel: model }),
  setPromptLanguage: (language) => set({ promptLanguage: language }),
  
  generatePrompt: async () => {
    set({ isGenerating: true });
    try {
      const { uploadedFile, selectedModel, promptLanguage } = get();
      // API è°ƒç”¨é€»è¾‘
      const prompt = await generateImagePrompt({
        file: uploadedFile,
        model: selectedModel,
        language: promptLanguage
      });
      set({ generatedPrompt: prompt });
    } catch (error) {
      console.error('Generate prompt failed:', error);
    } finally {
      set({ isGenerating: false });
    }
  }
}));
```

### API è®¾è®¡

#### æ–‡ä»¶ä¸Šä¼  API
```typescript
// apps/nextjs/src/app/api/upload/route.ts
export async function POST(request: Request) {
  const formData = await request.formData();
  const file = formData.get('file') as File;
  
  // æ–‡ä»¶éªŒè¯
  if (!file || !isValidImageFile(file)) {
    return NextResponse.json({ error: 'Invalid file' }, { status: 400 });
  }
  
  // ä¸Šä¼ åˆ°å­˜å‚¨æœåŠ¡
  const uploadUrl = await uploadToStorage(file);
  
  return NextResponse.json({ 
    success: true, 
    url: uploadUrl,
    metadata: {
      size: file.size,
      type: file.type,
      name: file.name
    }
  });
}
```

#### tRPC API é›†æˆ
```typescript
// packages/api/src/router/image-prompt.ts
export const imagePromptRouter = createTRPCRouter({
  generatePrompt: protectedProcedure
    .input(z.object({
      imageUrl: z.string().url(),
      model: z.enum(['general', 'flux', 'midjourney', 'stable-diffusion']),
      language: z.enum(['english', 'chinese', 'japanese', 'korean'])
    }))
    .mutation(async ({ input, ctx }) => {
      // è°ƒç”¨ AI æœåŠ¡
      const prompt = await aiService.generatePrompt({
        imageUrl: input.imageUrl,
        model: input.model,
        language: input.language
      });
      
      // ä¿å­˜åˆ°æ•°æ®åº“
      await ctx.db.insertInto('prompts').values({
        userId: ctx.session?.user?.id,
        imageUrl: input.imageUrl,
        model: input.model,
        language: input.language,
        generatedPrompt: prompt,
        createdAt: new Date()
      }).execute();
      
      return { prompt };
    }),
    
  getPromptHistory: protectedProcedure
    .query(async ({ ctx }) => {
      return await ctx.db
        .selectFrom('prompts')
        .where('userId', '=', ctx.session?.user?.id)
        .orderBy('createdAt', 'desc')
        .limit(20)
        .execute();
    })
});
```

### å›½é™…åŒ–æ”¯æŒ

å­—å…¸æ–‡ä»¶æ‰©å±•ï¼š
```json
{
  "imageToPrompt": {
    "meta": {
      "title": "Free Image to Prompt Generator - ImgPrompt.He",
      "description": "Convert images to detailed AI prompts with our free tool."
    },
    "header": {
      "title": "Free Image to Prompt Generator",
      "subtitle": "Convert Image to Prompt to generate your own image"
    },
    "upload": {
      "dragText": "Upload a photo or drag and drop",
      "formatText": "PNG, JPG, or WEBP up to 5MB",
      "uploadButton": "Upload Image",
      "urlPlaceholder": "Input Image URL"
    },
    "models": {
      "general": "General Image Prompt",
      "flux": "Flux",
      "midjourney": "Midjourney",
      "stableDiffusion": "Stable Diffusion"
    }
  }
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. å›¾ç‰‡ä¼˜åŒ–
```typescript
// å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ–
export async function optimizeImage(file: File): Promise<File> {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d')!;
    const img = new Image();
    
    img.onload = () => {
      // è®¡ç®—åˆé€‚çš„å°ºå¯¸
      const { width, height } = calculateOptimalSize(img.width, img.height);
      
      canvas.width = width;
      canvas.height = height;
      
      // ç»˜åˆ¶å’Œå‹ç¼©
      ctx.drawImage(img, 0, 0, width, height);
      canvas.toBlob((blob) => {
        const optimizedFile = new File([blob!], file.name, {
          type: 'image/jpeg',
          lastModified: Date.now()
        });
        resolve(optimizedFile);
      }, 'image/jpeg', 0.8);
    };
    
    img.src = URL.createObjectURL(file);
  });
}
```

#### 2. ä»£ç åˆ†å‰²
```typescript
// åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
const ImageEditor = dynamic(() => import('./image-editor'), {
  loading: () => <Skeleton className="h-64 w-full" />,
  ssr: false
});

const AIModelViewer = dynamic(() => import('./ai-model-viewer'), {
  loading: () => <div>Loading AI models...</div>
});
```

### é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ

#### 1. é”™è¯¯è¾¹ç•Œ
```typescript
export function ImageToPromptErrorBoundary({ children }: Props) {
  return (
    <ErrorBoundary
      fallback={({ error, resetError }) => (
        <Card className="p-8 text-center">
          <Icons.AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />
          <h2 className="text-xl font-semibold mb-2">Something went wrong</h2>
          <p className="text-muted-foreground mb-4">{error.message}</p>
          <Button onClick={resetError}>Try again</Button>
        </Card>
      )}
    >
      {children}
    </ErrorBoundary>
  );
}
```

#### 2. åŠ è½½çŠ¶æ€
```typescript
export function LoadingStates() {
  return (
    <div className="space-y-4">
      <Skeleton className="h-4 w-3/4" />
      <Skeleton className="h-32 w-full" />
      <div className="grid grid-cols-4 gap-4">
        {Array.from({ length: 4 }).map((_, i) => (
          <Skeleton key={i} className="h-24 w-full" />
        ))}
      </div>
    </div>
  );
}
```

### éƒ¨ç½²é…ç½®

#### ç¯å¢ƒå˜é‡
```bash
# AI æœåŠ¡é…ç½®
AI_SERVICE_URL=https://api.ai-service.com
AI_SERVICE_API_KEY=your_api_key

# æ–‡ä»¶å­˜å‚¨
UPLOAD_BUCKET=img-prompt-uploads
UPLOAD_REGION=us-east-1

# å›¾ç‰‡å¤„ç†
MAX_FILE_SIZE=5242880  # 5MB
ALLOWED_FORMATS=png,jpg,jpeg,webp
```

#### Vercel é…ç½®æ›´æ–°
```json
{
  "buildCommand": "turbo run build --filter=@saasfly/nextjs",
  "functions": {
    "apps/nextjs/src/app/api/upload/route.ts": {
      "maxDuration": 30
    }
  },
  "headers": [
    {
      "source": "/api/upload",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "*"
        }
      ]
    }
  ]
}
```

---

## å®æ–½æ—¶é—´è¡¨

### ç¬¬1å‘¨ï¼šåŸºç¡€æ¶æ„
- [ ] è·¯ç”±å’Œé¡µé¢ç»“æ„æ­å»º
- [ ] åŸºç¡€ç»„ä»¶å¼€å‘
- [ ] çŠ¶æ€ç®¡ç†å®ç°

### ç¬¬2å‘¨ï¼šæ ¸å¿ƒåŠŸèƒ½
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] å›¾ç‰‡é¢„è§ˆå’Œå¤„ç†
- [ ] API é›†æˆ

### ç¬¬3å‘¨ï¼šä¼˜åŒ–å’Œæµ‹è¯•
- [x] æ€§èƒ½ä¼˜åŒ–
- [x] é”™è¯¯å¤„ç†
- [x] æµ‹è¯•è¦†ç›–

### ç¬¬4å‘¨ï¼šé”™è¯¯ä¿®å¤å’Œä¼˜åŒ– (2025-09-12)
- [x] å­—å…¸è®¿é—®è·¯å¾„é”™è¯¯ä¿®å¤
- [x] Iconsç»„ä»¶å¯¼å…¥æ–¹å¼ä¿®å¤
- [x] å¼€å‘æœåŠ¡å™¨å¯åŠ¨ä¼˜åŒ–
- [x] å…¨é¢åŠŸèƒ½æµ‹è¯•
- [x] ç§»é™¤ "Text to Prompt" åŠŸèƒ½æ ‡ç­¾
- [x] ä¿®å¤ "Input Image URL" åŠŸèƒ½

---

## ğŸ”§ v3.0.1 - åŠŸèƒ½ä¼˜åŒ–å’Œä¿®å¤ (2025-09-12)

### ğŸ“ ä¿®æ”¹èƒŒæ™¯
æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œéœ€è¦å¯¹ Image to Prompt åŠŸèƒ½é¡µé¢è¿›è¡Œä¸¤å¤„ä¿®æ”¹ï¼š
1. ç§»é™¤ "Text to Prompt" åŠŸèƒ½æ ‡ç­¾
2. ä¿®å¤ "Input Image URL" åŠŸèƒ½

### ğŸ¯ ä¿®æ”¹ç›®æ ‡
- ç®€åŒ–åŠŸèƒ½é¡µé¢ï¼Œåªä¿ç•™æ ¸å¿ƒçš„ "Image to Prompt" åŠŸèƒ½
- ä¿®å¤ URL å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ
- ç¡®ä¿ä¿®æ”¹åçš„åŠŸèƒ½é€šè¿‡æµ‹è¯•éªŒè¯

### ğŸ› ï¸ æŠ€æœ¯å®ç°

#### 1. ç§»é™¤ "Text to Prompt" åŠŸèƒ½æ ‡ç­¾

**ä¿®æ”¹æ–‡ä»¶**: `apps/nextjs/src/app/[lang]/(tools)/image-to-prompt/components/feature-tabs.tsx`

ä¿®æ”¹äº† FeatureTabs ç»„ä»¶ï¼Œç§»é™¤äº† "Text to Prompt" æ ‡ç­¾ï¼Œåªä¿ç•™ "Image to Prompt" æ ‡ç­¾ã€‚ç›¸åº”åœ°æ›´æ–°äº† TypeScript æ¥å£å®šä¹‰ã€‚

#### 2. ä¿®å¤ "Input Image URL" åŠŸèƒ½

**ä¿®æ”¹æ–‡ä»¶**: `apps/nextjs/src/app/[lang]/(tools)/image-to-prompt/components/image-upload-section.tsx`

å®ç°äº†å®Œæ•´çš„ URL å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼š
1. é€šè¿‡ fetch API è·å– URL æŒ‡å‘çš„å›¾ç‰‡
2. å°†è·å–çš„å›¾ç‰‡æ•°æ®è½¬æ¢ä¸º File å¯¹è±¡
3. ä½¿ç”¨ç°æœ‰çš„æ–‡ä»¶éªŒè¯é€»è¾‘éªŒè¯å›¾ç‰‡
4. æ›´æ–°ä¸Šä¼ çŠ¶æ€å¹¶è§¦å‘å›è°ƒå‡½æ•°

### âœ… éªŒè¯ç»“æœ
- âœ… "Text to Prompt" æ ‡ç­¾å·²æˆåŠŸç§»é™¤ï¼Œé¡µé¢åªæ˜¾ç¤º "Image to Prompt" æ ‡ç­¾
- âœ… "Input Image URL" åŠŸèƒ½å·²ä¿®å¤ï¼Œå¯ä»¥æ­£å¸¸ä» URL è·å–å›¾ç‰‡å¹¶ä¸Šä¼ 
- âœ… é¡µé¢åŠŸèƒ½å®Œæ•´ï¼Œé€šè¿‡äº†æœ¬åœ°æµ‹è¯•éªŒè¯
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ (http://localhost:3003)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.0  
**åˆ›å»ºæ—¶é—´**: 2025-09-11  
**æŠ€æœ¯è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ